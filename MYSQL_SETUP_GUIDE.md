# MySQL Database Setup Guide

## Prerequisites

1. **Install MySQL Server** (if not already installed)
   - Download from: https://dev.mysql.com/downloads/mysql/
   - Or use XAMPP/WAMP which includes MySQL

2. **Start MySQL Service**
   - Windows: Services → MySQL → Start
   - Or start XAMPP/WAMP MySQL service

## Database Setup Steps

### Option 1: Using MySQL Workbench (Recommended)

1. Open MySQL Workbench
2. Connect to your local MySQL server
3. Open the schema file: `src/main/resources/schema.sql`
4. Execute the script (click the lightning bolt icon)
5. Verify tables are created in the `digital_health_db` database

### Option 2: Using Command Line

```bash
# Login to MySQL
mysql -u root -p

# Create database and tables
SOURCE C:/Users/mathew/Downloads/Digital-Health-Repository/src/main/resources/schema.sql

# Verify tables
USE digital_health_db;
SHOW TABLES;

# Exit
exit;
```

### Option 3: Using phpMyAdmin (if using XAMPP/WAMP)

1. Open http://localhost/phpmyadmin
2. Click "New" to create database
3. Database name: `digital_health_db`
4. Go to "Import" tab
5. Choose file: `src/main/resources/schema.sql`
6. Click "Go"

## Configuration

### Update Database Credentials (if needed)

Edit `application.properties`:

```properties
# Database Configuration
db.url=jdbc:mysql://localhost:3306/digital_health_db?useSSL=false&serverTimezone=UTC&allowPublicKeyRetrieval=true
db.username=root
db.password=YOUR_PASSWORD_HERE  # Change this to your MySQL password
db.driver=com.mysql.cj.jdbc.Driver
```

### Default Configuration

- **Database**: `digital_health_db`
- **Host**: `localhost`
- **Port**: `3306`
- **Username**: `root`
- **Password**: `root` (change this!)

## Running the Application

1. **Build the project**:
   ```bash
   mvn clean package -DskipTests
   ```

2. **Run the application**:
   ```bash
   java -cp target/digital-health-backend-1.0.0.jar com.digitalhealth.api.ApiServer
   ```

3. **Check the console output**:
   - You should see: `Using MySQL database backend`
   - If database connection fails, it will fallback to file-based storage

## Database Tables

The schema creates the following tables:

1. **patients** - Patient information
   - patient_id (PK)
   - name, age, gender, contact
   - timestamps

2. **doctors** - Doctor information
   - doctor_id (PK)
   - name, specialty
   - timestamps

3. **appointments** - Appointment bookings
   - appointment_id (PK)
   - patient_id, doctor_id (FKs)
   - appointment_datetime, status
   - timestamps

4. **health_records** - Patient health records
   - record_id (PK)
   - patient_id, doctor_id (FKs)
   - symptoms, diagnosis, prescription
   - record_date

5. **doctor_slots** - Doctor available time slots
   - id (PK, auto-increment)
   - doctor_id (FK)
   - slot_datetime, is_available
   - timestamp

## Troubleshooting

### Connection Issues

**Error: "Access denied for user 'root'@'localhost'"**
- Update password in `application.properties`

**Error: "Unknown database 'digital_health_db'"**
- Run the schema.sql script to create the database

**Error: "Communications link failure"**
- Make sure MySQL service is running
- Check if port 3306 is correct

### Fallback to File-Based Storage

If MySQL connection fails, the application automatically falls back to file-based storage (.dat files). Check the console output to see which backend is being used.

## Verify MySQL Integration

1. Start the application
2. Register a patient via the web interface
3. Check MySQL database:
   ```sql
   USE digital_health_db;
   SELECT * FROM patients;
   ```
4. You should see the newly registered patient

## Migration from File-Based to MySQL

If you have existing data in .dat files and want to migrate to MySQL:

1. **Backup your .dat files** (in the `data/` directory)
2. **Setup MySQL database** (follow steps above)
3. **Manually migrate data**:
   - The application will start fresh with MySQL
   - You'll need to re-register patients, doctors, etc.
   - Or write a migration script to import from .dat files

## Notes

- **Auto-Increment IDs**: Patient IDs (P0001), Doctor IDs (D0001), etc. are still generated by the Java application, not by MySQL AUTO_INCREMENT
- **Transactions**: MySQL DAOs use transactions for data consistency
- **Foreign Keys**: Cascading deletes are enabled (deleting a patient deletes their appointments and records)
- **Indexes**: Created on frequently queried columns for better performance
